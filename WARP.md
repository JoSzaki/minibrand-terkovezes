# WARP.md

This file provides guidance to WARP (warp.dev) when working with code in this repository.

## Project Overview

This is a Hungarian térkövezés (paving/concrete laying) business website built with **Astro 5.13+**. It's a static site deployed to GitHub Pages with a focus on performance optimization, SEO, and lead generation. The site targets Hungarian customers looking for professional paving services in Budapest.

## Common Development Commands

### Development Server
```bash
cd live
npm run dev              # Start development server at localhost:4321
```

### Building and Testing
```bash
cd live
npm run build           # Build production site to ./dist/
npm run preview         # Preview production build locally
npm run astro -- --help # Get Astro CLI help
```

### Performance Testing
```bash
cd live
npm run perf:test       # Run comprehensive performance tests with Playwright
npm run perf:lighthouse # Run Lighthouse CI performance audit  
npm run perf:bundle     # Analyze bundle size and generate recommendations
npm run perf:all        # Run all performance tests sequentially
npm run report          # Generate performance and bundle analysis reports
```

### Single Test Commands
```bash
cd live
node performance-test.js  # Run performance test on localhost:4324
node bundle-analysis.js   # Analyze build bundle sizes
```

## Architecture Overview

### Project Structure
- **Working directory**: `live/` (all development happens here)
- **Source**: `live/src/` (Astro components, pages, data)
- **Public assets**: `live/public/` (static images, favicon)
- **Build output**: `live/dist/` (generated by `npm run build`)

### Key Architectural Patterns

1. **Static Data-Driven Content**: Blog posts and service pages are generated from JavaScript data objects in `src/data/blogPosts.js`, allowing for rich content with calculators, FAQs, and structured data.

2. **Component-Based Layout System**: 
   - `Layout.astro` - Base HTML structure with critical CSS inlined
   - `Header.astro` / `Footer.astro` - Site navigation and footer
   - `EnhancedContent.astro` - Renders structured blog content with tables, infographics, and calculators

3. **Performance-First Architecture**:
   - Critical CSS inlined in `<head>`
   - Optimized image loading with WebP/JPEG responsive images
   - Font loading optimization with `font-display: swap`
   - Manual chunk splitting for vendor libraries (Flowbite)

4. **SEO-Optimized Structure**:
   - Schema.org structured data generation
   - Meta tags and Open Graph optimization
   - Internal linking strategy via `src/data/internalLinks.js`

### Data Architecture

The site uses a centralized data structure in `src/data/blogPosts.js` where each blog post object contains:

- **Basic metadata**: title, description, date, category
- **Structured content**: sections with HTML content, infographics, tables
- **Interactive elements**: cost calculators with JavaScript
- **FAQ sections**: structured Q&A data
- **How-to guides**: step-by-step instructions

### Calculator System

Interactive cost calculators are embedded in blog posts using:
```javascript
calculator: {
  title: "Calculator Title",
  inputs: [/* input definitions */],
  script: `/* JavaScript code as string */`
}
```

**Important**: Calculator JavaScript uses `set:html` directive and requires careful syntax - avoid template literals with backticks in the embedded JavaScript.

## Development Guidelines

### Content Updates

1. **Blog Posts**: Edit `src/data/blogPosts.js` - each post is a complete JavaScript object with all content and metadata.

2. **Calculator Fixes**: When fixing calculators, ensure:
   - Proper JavaScript syntax (avoid `innerHTML:`, use `innerHTML =`)
   - Input validation for user data
   - Hungarian number formatting with `toLocaleString('hu-HU')`
   - Error handling with user-friendly messages
   - Disclaimer text and call-to-action buttons

3. **Image Optimization**: Images are pre-optimized with multiple formats (WebP, JPEG) and sizes using the responsive image pattern in `OptimizedImage.astro`.

### Performance Considerations

- **Build Configuration**: Uses Terser for minification, CSS code splitting, and manual chunks
- **Performance Thresholds**: 
  - FCP: <1800ms, LCP: <2500ms, TTFB: <600ms
  - Bundle size warnings: JS >300KB, CSS >100KB, Images >1000KB
- **Testing**: Run `npm run perf:all` before deployment to catch performance regressions

### Deployment Process

1. **GitHub Pages**: Site deploys automatically on push to main branch
2. **Base URL**: Uses `/minibrand-terkovezes/` as base path (configured in `astro.config.mjs`)
3. **Asset Optimization**: Automatic CSS/JS minification, asset hashing, and compression

### Code Style and Patterns

- **Component Props**: Use TypeScript interfaces for prop definitions
- **Styling**: TailwindCSS with custom color palette (primary, concrete colors)
- **Content Rendering**: Use `set:html` for dynamic content, `set:text` for plain text
- **Internal Links**: Always use `${import.meta.env.BASE_URL}` prefix for internal navigation

### Debugging Common Issues

1. **Calculator Not Working**: Check JavaScript syntax in `blogPosts.js`, ensure proper escaping
2. **Images Not Loading**: Verify path starts with `/minibrand-terkovezes/` for production
3. **Performance Issues**: Run bundle analysis to identify large assets
4. **Build Failures**: Check TypeScript errors and Astro component syntax

### Content Templates

When creating new calculators, follow the pattern in `CALCULATOR_FIX_TEMPLATE.md` which includes:
- Input validation and error handling
- Hungarian localization
- Disclaimer text
- Call-to-action buttons linking to contact page
- Proper positioning after first paragraph

## Key Business Context

This is a Hungarian B2C service business website focusing on:
- **Target Market**: Hungarian homeowners in Budapest area
- **Services**: Kocsibeálló (driveways), terasz (patios), járda (walkways) paving
- **Lead Generation**: Contact forms, phone calls, cost calculators
- **Local SEO**: Hungarian keywords, Budapest location targeting

The site emphasizes trust-building through detailed guides, transparent pricing information, and professional presentation to convert visitors into consultation requests.