---
import Layout from '../../components/Layout.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import CTA from '../../components/CTA.astro';
import { generateSchemasForPage } from '../../schema-config.js';
import { blogPosts } from '../../data/blogPosts.js';

// Generate static paths for all blog posts
export async function getStaticPaths() {
    return blogPosts.map((post) => ({
        params: { slug: post.slug },
        props: post,
    }));
}

const { title, description, date, category, author, readTime, excerpt, slug, content, images, faq, tables, howTo, infographics, calculator } = Astro.props;
const metaDescription = description;

// Generate schemas for blog post with FAQ and HowTo data
const schemaData = {
    headline: title,
    description: excerpt,
    datePublished: date,
    dateModified: date,
    author: { name: author },
    publisher: { 
        name: "Térkövezés Budapest",
        logo: {
            url: "https://joszaki.github.io/favicon.svg"
        }
    },
    mainEntityOfPage: {
        "@id": `https://joszaki.github.io/blog/${slug}/`
    },
    image: {
        url: images?.hero?.src || "/images/hero-terkovezes.jpg",
        width: 1200,
        height: 630
    }
};

// Add FAQ data if available
if (faq && faq.length > 0) {
    schemaData.faq = {
        mainEntity: faq.map(item => ({
            "@type": "Question",
            "name": item.question,
            "acceptedAnswer": {
                "@type": "Answer",
                "text": item.answer
            }
        }))
    };
}

// Add HowTo data if available
if (howTo && howTo.steps && howTo.steps.length > 0) {
    schemaData.howto = {
        name: howTo.title || title,
        description: howTo.description || excerpt,
        image: images?.hero?.src || "/images/hero-terkovezes.jpg",
        totalTime: "PT" + (readTime || "15") + "M",
        step: howTo.steps.map((step, index) => ({
            "@type": "HowToStep",
            "position": index + 1,
            "name": step.title,
            "text": step.description,
            "tip": step.tips || ""
        }))
    };
}

const blogSchemas = generateSchemasForPage('blog', schemaData);
---

<Layout title={title + " - Térkövezés Budapest"} description={metaDescription}>
    <!-- Schema Markup -->
    {blogSchemas.map(schema => (
        <script type="application/ld+json" set:html={JSON.stringify(schema)}></script>
    ))}
    
    <Header />
    
    <!-- Breadcrumb -->
    <nav class="bg-concrete-50 py-4">
        <div class="max-w-screen-xl mx-auto px-4 sm:px-6 lg:px-8">
            <ol class="flex items-center space-x-2 text-sm text-concrete-600">
                <li><a href={import.meta.env.BASE_URL} class="hover:text-primary-600">Főoldal</a></li>
                <li class="flex items-center">
                    <svg class="w-4 h-4 mx-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 111.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"/>
                    </svg>
                    <a href={`${import.meta.env.BASE_URL}blog`} class="hover:text-primary-600">Blog</a>
                </li>
                <li class="flex items-center">
                    <svg class="w-4 h-4 mx-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 111.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"/>
                    </svg>
                    <span class="text-concrete-800 font-medium">{title}</span>
                </li>
            </ol>
        </div>
    </nav>

    <!-- Article Header -->
    <article class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
        <header class="mb-8">
            <div class="flex items-center justify-between mb-6">
                <span class="bg-primary-100 text-primary-800 text-sm font-semibold px-3 py-1 rounded-full">
                    {category}
                </span>
                <span class="text-concrete-500">{readTime} olvasás</span>
            </div>
            
            <h1 class="text-4xl lg:text-5xl font-bold text-concrete-800 font-heading mb-6">
                {title}
            </h1>
            
            <div class="flex items-center text-concrete-600">
                <span>Szerző: {author}</span>
                <span class="mx-3">•</span>
                <time datetime={date}>
                    {new Date(date).toLocaleDateString('hu-HU', { 
                        year: 'numeric', 
                        month: 'long', 
                        day: 'numeric' 
                    })}
                </time>
            </div>
        </header>

        <!-- Hero Image -->
        {images && images.hero && (
            <div class="mb-8">
                <img src={images.hero.src} alt={images.hero.alt} class="w-full h-64 md:h-80 object-cover rounded-xl shadow-lg">
                {images.hero.caption && <p class="text-sm text-concrete-500 mt-2 text-center">{images.hero.caption}</p>}
            </div>
        )}

        <!-- Article Content -->
        <div class="prose prose-lg max-w-none">
            <div class="blog-content">
                <p class="text-lg leading-relaxed mb-8">{excerpt}</p>
                
                <!-- Main Content Sections -->
                {content && content.sections && content.sections.map(section => (
                    <section class="mb-12">
                        <h2 class="text-3xl font-bold text-concrete-800 font-heading mb-6">{section.title}</h2>
                        
                        {section.content && (
                            <div class="mb-6" set:html={section.content}></div>
                        )}
                        
                        {section.image && (
                            <div class="my-8">
                                <img src={section.image.src} alt={section.image.alt} class="w-full rounded-lg shadow-md">
                                {section.image.caption && <p class="text-sm text-concrete-500 mt-2 text-center">{section.image.caption}</p>}
                            </div>
                        )}
                        
                        {section.infographic && (
                            <div class="bg-gradient-to-br from-primary-50 to-primary-100 rounded-xl p-8 my-8">
                                <h3 class="text-xl font-bold text-primary-800 mb-4 text-center">{section.infographic.title}</h3>
                                <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                                    {section.infographic.items.map(item => (
                                        <div class="bg-white rounded-lg p-6 text-center shadow-sm">
                                            <div class="text-4xl mb-4">{item.icon}</div>
                                            <h4 class="font-semibold text-concrete-800 mb-2">{item.title}</h4>
                                            <p class="text-concrete-600 text-sm">{item.description}</p>
                                            {item.value && <div class="text-2xl font-bold text-primary-600 mt-3">{item.value}</div>}
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}
                        
                        {section.table && (
                            <div class="overflow-x-auto my-8">
                                <table class="min-w-full bg-white border border-concrete-200 rounded-lg overflow-hidden">
                                    <thead class="bg-concrete-50">
                                        <tr>
                                            {section.table.headers.map(header => (
                                                <th class="px-6 py-3 text-left text-xs font-medium text-concrete-500 uppercase tracking-wider">{header}</th>
                                            ))}
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-concrete-200">
                                        {section.table.rows.map(row => (
                                            <tr>
                                                {row.map(cell => (
                                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-concrete-900">{cell}</td>
                                                ))}
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        )}
                    </section>
                ))}
                
                <!-- How-to Section -->
                {howTo && (
                    <section class="bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl p-8 my-12">
                        <h2 class="text-3xl font-bold text-concrete-800 font-heading mb-6 flex items-center">
                            <span class="text-4xl mr-3">📋</span>
                            {howTo.title}
                        </h2>
                        <div class="space-y-6">
                            {howTo.steps.map((step, index) => (
                                <div class="flex items-start space-x-4">
                                    <div class="flex-shrink-0 w-10 h-10 bg-primary-600 text-white rounded-full flex items-center justify-center font-bold">
                                        {index + 1}
                                    </div>
                                    <div class="flex-1">
                                        <h3 class="text-lg font-semibold text-concrete-800 mb-2">{step.title}</h3>
                                        <p class="text-concrete-700 mb-3">{step.description}</p>
                                        {step.tips && (
                                            <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded">
                                                <p class="text-yellow-800 font-medium">💡 Profi tipp: {step.tips}</p>
                                            </div>
                                        )}
                                    </div>
                                </div>
                            ))}
                        </div>
                    </section>
                )}
                
                <!-- FAQ Section -->
                {faq && (
                    <section class="my-12">
                        <h2 class="text-3xl font-bold text-concrete-800 font-heading mb-8 text-center">
                            ❓ Gyakran Ismételt Kérdések
                        </h2>
                        <div class="space-y-4">
                            {faq.map((item, index) => (
                                <details class="bg-white border border-concrete-200 rounded-lg shadow-sm">
                                    <summary class="px-6 py-4 cursor-pointer hover:bg-concrete-50 font-medium text-concrete-800">
                                        {item.question}
                                    </summary>
                                    <div class="px-6 pb-4 text-concrete-600 border-t border-concrete-100" set:html={item.answer}></div>
                                </details>
                            ))}
                        </div>
                    </section>
                )}
                
                <!-- Calculator Section -->
                {calculator && (
                    <section class="bg-primary-50 rounded-xl p-8 my-12">
                        <h2 class="text-3xl font-bold text-concrete-800 font-heading mb-6 text-center flex items-center justify-center">
                            <span class="text-4xl mr-3">🧮</span>
                            {calculator.title}
                        </h2>
                        <div class="max-w-md mx-auto bg-white rounded-lg p-6 shadow-lg">
                            <div class="space-y-4">
                                {calculator.inputs.map(input => (
                                    <div>
                                        <label class="block text-sm font-medium text-concrete-700 mb-2">{input.label}</label>
                                        {input.type === 'select' ? (
                                            <select 
                                                id={input.id}
                                                class="w-full px-3 py-2 border border-concrete-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500"
                                            >
                                                {input.options && input.options.map(option => (
                                                    <option value={option.value}>{option.label}</option>
                                                ))}
                                            </select>
                                        ) : input.type === 'checkbox' ? (
                                            <label class="flex items-center">
                                                <input 
                                                    type="checkbox" 
                                                    id={input.id}
                                                    class="mr-2 h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"
                                                >
                                                <span class="text-sm text-concrete-700">Igen, vízelvezetés szükséges (+3.000 Ft/m²)</span>
                                            </label>
                                        ) : (
                                            <input 
                                                type={input.type || 'number'} 
                                                id={input.id}
                                                placeholder={input.placeholder}
                                                class="w-full px-3 py-2 border border-concrete-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500"
                                            >
                                        )}
                                        {input.unit && input.type !== 'checkbox' && <span class="text-sm text-concrete-500 ml-2">{input.unit}</span>}
                                    </div>
                                ))}
                                <button 
                                    onclick="calculateCost()"
                                    class="w-full bg-primary-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-primary-700 transition-colors"
                                >
                                    Számítás
                                </button>
                                <div id="calculator-result" class="mt-4 p-4 bg-green-50 border-l-4 border-green-400 rounded hidden">
                                    <div class="font-semibold text-green-800"></div>
                                </div>
                            </div>
                        </div>
                        <script set:html={calculator.script}></script>
                    </section>
                )}
                
                <!-- CTA Section -->
                <div class="bg-gradient-to-r from-primary-600 to-primary-800 text-white rounded-xl p-8 text-center my-12">
                    <h3 class="text-2xl font-bold mb-4">Térkövezésre van Szüksége?</h3>
                    <p class="text-xl mb-8 opacity-90">
                        15+ év tapasztalattal segítünk minden térkövezési projektben 
                        professzionális megoldást nyújtani!
                    </p>
                    <div class="flex flex-col sm:flex-row gap-4 justify-center">
                        <a 
                            href={`${import.meta.env.BASE_URL}kapcsolat`} 
                            class="bg-white text-primary-600 px-8 py-3 rounded-lg font-semibold hover:bg-gray-100 transition-colors"
                        >
                            Ingyenes Árajánlat
                        </a>
                        <a 
                            href="tel:+36705786296" 
                            class="bg-primary-700 text-white px-8 py-3 rounded-lg font-semibold hover:bg-primary-800 transition-colors"
                        >
                            📞 Hívjon Azonnal
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Newsletter & Contact -->
        <footer class="mt-12 pt-8 border-t border-concrete-200">
            <div class="bg-concrete-50 rounded-xl p-8 text-center">
                <h3 class="text-2xl font-semibold text-concrete-800 mb-4">
                    Hasznos volt a cikk?
                </h3>
                <p class="text-concrete-600 mb-6">
                    Oszd meg vagy iratkozz fel hírlevelünkre a friss térkövezési tippekért és szakmai cikkekért!
                </p>
                <div class="flex flex-col sm:flex-row gap-4 justify-center">
                    <a href="/blog" class="bg-primary-600 hover:bg-primary-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors duration-200 inline-block">
                        További Cikkek
                    </a>
                    <a href="mailto:?subject=Érdekes térkövezési cikk&body=Találtam egy hasznos cikket: ${window.location.href}" class="border-2 border-primary-600 text-primary-600 hover:bg-primary-600 hover:text-white font-semibold py-3 px-6 rounded-lg transition-colors duration-200 inline-block">
                        Megosztás
                    </a>
                </div>
            </div>
        </footer>
    </article>

    <!-- Related Articles -->
    <section class="py-16 bg-concrete-50">
        <div class="max-w-screen-xl mx-auto px-4 sm:px-6 lg:px-8">
            <h2 class="text-3xl font-bold text-concrete-800 font-heading text-center mb-12">
                Kapcsolódó cikkek
            </h2>
            <div class="grid md:grid-cols-3 gap-8">
                <!-- Related article cards would go here -->
                <div class="bg-white border border-concrete-200 rounded-xl p-6">
                    <h3 class="text-xl font-semibold text-concrete-800 mb-3">Hogyan válasszunk térkövet</h3>
                    <p class="text-concrete-600 mb-4">Budapest útmutató a megfelelő térkő kiválasztásához...</p>
                    <a href="/blog/hogyan-valasszunk-terkovet" class="text-primary-600 hover:text-primary-700 font-semibold">Tovább →</a>
                </div>
                <div class="bg-white border border-concrete-200 rounded-xl p-6">
                    <h3 class="text-xl font-semibold text-concrete-800 mb-3">Térkő árak Budapest 2024</h3>
                    <p class="text-concrete-600 mb-4">Aktuális térkövezési árak és költségkalkuláció...</p>
                    <a href="/blog/terko-arak-budapest-2024" class="text-primary-600 hover:text-primary-700 font-semibold">Tovább →</a>
                </div>
                <div class="bg-white border border-concrete-200 rounded-xl p-6">
                    <h3 class="text-xl font-semibold text-concrete-800 mb-3">Térkő karbantartása és tisztítása</h3>
                    <p class="text-concrete-600 mb-4">Hogyan tartsd karban és tisztítsd a térköveket...</p>
                    <a href="/blog/terko-karbantartasa-tisztitasa" class="text-primary-600 hover:text-primary-700 font-semibold">Tovább →</a>
                </div>
            </div>
        </div>
    </section>

    <!-- Call to Action -->
    <CTA
        title="Kérd be térkövezési árajánlatodat!"
        description="Professzionális térkövezési szolgáltatások Budapesten és környékén. Ingyenes helyszíni felmérés és részletes árajánlat."
    />

    <Footer />
</Layout>

<style>
.blog-content {
    @apply text-concrete-700 leading-relaxed;
}

.blog-content h2 {
    @apply text-2xl font-semibold text-concrete-800 mt-8 mb-4;
}

.blog-content h3 {
    @apply text-xl font-semibold text-concrete-800 mt-6 mb-3;
}

.blog-content p {
    @apply mb-4;
}

.blog-content ul, .blog-content ol {
    @apply ml-6 mb-4 space-y-2;
}

.blog-content li {
    @apply text-concrete-700;
}

.blog-content a {
    @apply text-primary-600 hover:text-primary-700 underline;
}
</style>