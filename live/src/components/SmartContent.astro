---
// Intelligens tartalom komponens, amely automatikusan feldolgozza a slotból érkező tartalmat
import { processContentForLinks } from '../utils/contentProcessor.js';

export interface Props {
  currentSlug: string;
  maxLinksPerParagraph?: number;
  className?: string;
}

const { 
  currentSlug, 
  maxLinksPerParagraph = 2,
  className = 'space-y-6 text-lg text-concrete-600'
} = Astro.props;

// A slot tartalmát nem tudjuk itt feldolgozni server-side,
// ezért egy wrapper komponenst készítünk, amely client-side dolgozza fel
---

<div class={`smart-content ${className}`} data-current-slug={currentSlug} data-max-links={maxLinksPerParagraph}>
  <slot />
</div>

<script>
  import { processContentForLinks } from '../utils/contentProcessor.js';
  
  // Optimized client-side content processing with debouncing
  const processSmartContent = () => {
    const smartContentElements = document.querySelectorAll('.smart-content');
    
    // Use document fragment for better performance
    smartContentElements.forEach(element => {
      const currentSlug = element.getAttribute('data-current-slug');
      const maxLinks = parseInt(element.getAttribute('data-max-links') || '2');
      
      if (currentSlug && !element.dataset.processed) {
        // Mark as processed to avoid duplicate processing
        element.dataset.processed = 'true';
        
        const originalContent = element.innerHTML;
        const processedContent = processContentForLinks(originalContent, currentSlug, maxLinks);
        
        // Only update if content actually changed
        if (processedContent !== originalContent) {
          element.innerHTML = processedContent;
        }
      }
    });
  };

  // Use requestIdleCallback for non-critical processing
  if ('requestIdleCallback' in window) {
    requestIdleCallback(processSmartContent);
  } else {
    // Fallback for older browsers
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', processSmartContent);
    } else {
      setTimeout(processSmartContent, 0);
    }
  }
</script>

<style>
  .smart-content :global(a) {
    @apply text-primary-600 hover:text-primary-700 underline;
    @apply transition-colors duration-200;
  }
  
  .smart-content :global(a:hover) {
    @apply decoration-2;
  }
</style>